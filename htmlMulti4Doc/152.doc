<!DOCTYPE html>
<html lang="zh-cmn">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="keywords"
          content="WEBVPN,VPN,clientless vpn,网瑞达,北京网瑞达科技有限公司,资源访问控制系统,访问控制,堡垒机,SSLVPN,CASB,认证,成都网瑞达科技有限公司,图书馆认证,图书馆统计,图书馆下载分析,电子资源访问控制,论文下载,访问,图书馆"/>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit">
    <link rel="stylesheet" href="/wengine-vpn/js/css/normalize.css"/>
    <link rel="stylesheet" href="/wengine-vpn/js/css/login.css"/>
    <link rel="stylesheet" href="/wengine-vpn/js/layui/css/layui.css">
    <title>桂林电子科技大学WebVPN</title>
</head>
<body>
<div class="background">
</div>
<div class="main">
    <div class="header">
    
        <div class="portal-logo">
            <img style="height:100%" src="/wengine-vpn/js/image/logo.png"/>
        </div>
        <div class="portal-title">
        桂林电子科技大学WebVPN
        </div>
    
    </div>
    <div class="container">
        <div class="notice-panel">
            <div class="notice-box">
                <div class="notice-title">
                通知
                </div>
                <div class="notice-break-line"></div>
                <div class="notice-content">
                <p>为了方便校外师生在外网访问内网和图书馆资源，开通了新版VPN，无需客户端安装，支持电脑和手机直接使用，为了获得更好的体验建议使用Chrome、Firefox、IE11、Edge、Safari等浏览器。</p><p>该VPN的账号密码为校园网出校认证的账号和密码。若忘记账号密码，可通过手机端关注“桂林电子科技大学智慧校园”微信公众号后进入公众号的“一站式服务大厅”来申请重置“上网密码”。</p><p>若您在知道账号密码情况下需要更改旧密码，请在登录VPN后进入https://drcom.guet.edu.cn/Self/login 来登录出校认证自助服务页面进行更改。</p>
                </div>
            </div>
        </div>
        <div class="login-panel">
            <div class="login-box">
            
            <div id="nav" class="login-nav only-auth">
            
            
                <div class="on" data-type="local" id="local">账号登录</div>
            
            
            
                
            </div>
                <form class="el-form el-form--label-top" method="POST" action="/do-login?local_login=true">
                    <input name="auth_type" type="hidden" value="local"/>
                    <div class="wechat-qrcode" style="margin-top: 20px">
                        
                    </div>
                
                    <div class="login-form-item">
                        <div class="el-input user-input">
                            <input autocomplete="new-password" id="user_name" placeholder="用户名"
                                   type="text" name="username">
                        </div>
                    </div>
                

                    <div class="login-form-item sms-field" style="display:none;">
                        <div class="el-input phone-code-input">
                            <input autocomplete="new-code" placeholder="验证码" type="text" name="sms_code"
                                   id="phone-code-input" style="flex:1">
                            <div class="send-sms" id="send-sms">点击发送</div>
                            <img id="help_mark" class="help-mark sms-wx-field"
                                 src="/wengine-vpn/js/image/question-mark.png"/>
                        </div>
                    </div>

                
                    <div class="login-form-item password-field">
                        <div class="el-input password-input">
                            <input autocomplete="new-password" placeholder="密码" type="password" name="password">
                        </div>
                    </div>
                
                
                    <div class="upper-login-field">
                    
                    
                        <div class="remember-field">
                            <input type="checkbox" name="remember_cookie" style="vertical-align: middle;"></span>
                            <span>下次自动登录</span>
                        </div>
                    
                    </div>

                
                    <button type="submit" class="el-button-login" style="margin-bottom:20px;">
                        <span>登录</span>
                    </button>
                
                </form>
                <div class="link-field">
                
                    <a id="cas-login" class="link-login" href="/login?cas_login=true"
                       style="text-decoration:none;color:white;">
                        <img src="/wengine-vpn/js/image/cas.png" alt="">
                        统一身份认证登录
                    </a>
                
                
                </div>
                <div class="mobile-notice-panel">
                    <div class="notice-box">
                        <div class="notice-break-line"></div>
                        <div class="notice-title">
                        通知
                        </div>
                        <div class="notice-content">
                        <p>为了方便校外师生在外网访问内网和图书馆资源，开通了新版VPN，无需客户端安装，支持电脑和手机直接使用，为了获得更好的体验建议使用Chrome、Firefox、IE11、Edge、Safari等浏览器。</p><p>该VPN的账号密码为校园网出校认证的账号和密码。若忘记账号密码，可通过手机端关注“桂林电子科技大学智慧校园”微信公众号后进入公众号的“一站式服务大厅”来申请重置“上网密码”。</p><p>若您在知道账号密码情况下需要更改旧密码，请在登录VPN后进入https://drcom.guet.edu.cn/Self/login 来登录出校认证自助服务页面进行更改。</p>
                        </div>
                    </div>
                </div>
            </div>
            </div>

            <div id="wechat_tip" style="display:none;padding:10px">
                <div style="font-size:16px">1. 请先扫描二维码并关注该服务公众号</div>
                <img src="/wengine-vpn/js/image/wx.png" style="width:120px;height:120px;margin-left:15px;"/>
                <div style="font-size:16px">2. 进入公众号点击”用户认证“进行认证</div>
            </div>
        </div>
        <div class="footer" style="text-align: center;margin-top: 20px;margin-bottom: 10px;">
        
        </div>
    </div>
    <div class="second-login-layer" id="second_login_layer" style="display:none">
        <div class="layer-form-title">
            双重登录认证
        </div>
        <form id="second_login_form" class="layui-form">
            <input type="hidden" name="username" autocomplete="off" value="">
            <input type="hidden" class="phone-input" name="phone" autocomplete="off" value="">
            <input type="hidden" name="token" autocomplete="off" value="">
            <div class="layui-form-item">
                <label class="layui-form-label">手机号</label>
                <div class="layui-input-block">
                    <input type="text" name="disable_phone" autocomplete="off" disabled class="layui-input"
                           value="�������****" style="border:none">
                </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">验证码</label>
                    <div class="layui-input-inline" style="width:160px;">
                        <input type="text" name="code" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-inline">
                    <div class="layui-input-inline" style="width:60px;">
                        <div class="layui-btn layui-btn-mormal send-message" style="background:#1B9EF3;">获取验证码</div>
                    </div>
                </div>
            </div>
            <div>
                <input type="button" id="submit_second_login" class="layui-btn layui-btn-mormal"
                       style="background:#1B9EF3;float:right" value="继续登录"/>
            </div>

        </form>
    </div>

    <script type="text/javascript" src="/wengine-vpn/js/js/jquery.min.js"></script>
    <script type="text/javascript" src="/wengine-vpn/js/layer-v3.1.1/layer.js"></script>
    <script type="text/javascript" src="/wengine-vpn/js/layui/layui.js"></script>
    <script type="text/javascript" src="//rescdn.qqmail.com/node/ww/wwopenmng/js/sso/wwLogin-1.0.0.js"></script>
    <script type="text/javascript">
        var token = ''
        if (token != "") {
            index = layer.open({
                type: 1,
                shade: 0.3,
                title: false,
                shadeClose: true,
                closeBtn: 1,
                scrollbar: false,
                offset: '350px',
                area: "460px",
                content: $('#second_login_layer')
            });
        }

        var logoutByOther = ''
        if (logoutByOther != "") {
            layer.msg("您的账号已经在其他地点登录，请检查账号密码是否泄漏");
        }

        var userName = ''
        var logoutOtherToken = ''
        if (logoutOtherToken != "") {
            layer.confirm('该账号已经登录，继续登录将踢掉其他已登录账号', {
                btn: ['继续', '取消'] 
            }, function () {
                $.ajax({
                    url: "/do-confirm-login",
                    data: {username: userName, logoutOtherToken: logoutOtherToken},
                    dataType: 'json',
                    type: 'POST',
                    success: function (res) {
                        if (res.success) {
                            layer.msg("登录成功！");
                            setTimeout(function () {
                                window.location.href = res.data
                            }, 1000);
                        } else {
                            layer.msg(res.data);
                        }
                    }
                })
            }, function () {
                
            });
        }

        var sec;
        var intervalId = 0;
        $(function () {
            $('#user_name').focus();
            
            $('#send-sms').click(function () {
                var user_name = $("#user_name").val()
                var auth_type = $(".on").data('type')

                var $that = $(this);
                if(user_name.length != 11){
                    layer.msg('您的手机号格式不正确,无法获得验证码！');
                    return
                }
                if ($(this).hasClass('disabled')) {
                    return;
                }
                window.clearInterval(intervalId);
                $.post('/send-sms/', {username: user_name, auth_type: auth_type}, function (res) {
                    if (res == "False") {
                        layer.msg('您的账号无权登录,无法获得验证码！');
                        return;
                    }
                });
                sec = 59;
                $that.html(sec);
                $(this).addClass('disabled');
                intervalId = setInterval(function () {
                    counting = true;
                    $that.html(sec);
                    sec -= 1;
                    if (sec < 0) {
                        $that.removeClass('disabled');
                        counting = false;
                        $that.html('点击发送');
                    }
                }, 1000);
            })

            $('.send-message').click(function () {
                var user_name = $($(this).parents("form").find(".phone-input")[0]).val()
                var auth_type = "auth_sms"

                var $that = $(this);
                if ($(this).hasClass('disabled')) {
                    return;
                }
                window.clearInterval(intervalId);
                $.post('/send-sms/', {username: user_name, auth_type: auth_type, double_check: "send"}, function (res) {
                    if (res == 'False') {
                        layer.msg('无法获得验证码！');
                    }
                });
                sec = 59;
                $that.html(sec);
                $(this).addClass('disabled');
                intervalId = setInterval(function () {
                    counting = true;
                    $that.html(sec);
                    sec -= 1;
                    if (sec < 0) {
                        $that.removeClass('disabled');
                        counting = false;
                        $that.html('获取验证码');
                    }
                }, 1000);
            })

            $('#submit_second_login').click(function () {
                var data = $("#second_login_form").serialize();
                $.ajax({
                    url: "/do-second-login",
                    data: data,
                    dataType: 'json',
                    type: 'POST',
                    success: function (res) {
                        if (res.success) {
                            layer.msg("登录成功！");
                            setTimeout(function () {
                                window.location.href = res.data;
                            }, 1000);
                        } else {
                            layer.msg(res.data);
                        }
                    }
                })
            });

            $('#submit_confirm_login').click(function () {
                var data = $("#confirm_login_form").serialize();
                $.ajax({
                    url: "/do-confirm-login",
                    data: data,
                    dataType: 'json',
                    type: 'POST',
                    success: function (res) {
                        if (res.success) {
                            layer.msg("登录成功！");
                            setTimeout(function () {
                                window.location.href = res.data
                            }, 1000);
                        } else {
                            layer.msg(res.data);
                        }
                    }
                })
            });


            var tab_name = 'local'
            if (tab_name == 'auth_sms') {
                delayClick("auth_sms")
            } else if (tab_name == 'auth_wx_sms') {
                delayClick("auth_wx_sms")
            } else {
                delayClick("local")
            }

            function delayClick(idName) {
                setTimeout(
                        function () {
                            $("#" + idName + "").click()
                        },
                        100
                )
            }

            $("#nav div").off("click").on("click", function () {
                var index = $(this).index();
                $(this).addClass("on").siblings().removeClass("on");
                if ($(this).data('type') == 'local') {
                    $('.password-field').show();
                    $('.sms-field').hide();
                    $('.el-button-login').show();
                    $('input[name=auth_type]').val('local');
                    $('#user_name').parent().removeClass('phone-input');
                    $('#user_name').parent().removeClass('user-input');
                    $('#user_name').parent().addClass('user-input');
                    $('#user_name').attr('placeholder', "用户名");
                    $('.user-input').show();
                    $('.remember-field').show();
                    $('.wechat-qrcode').hide();
                } else if ($(this).data('type') == 'auth_sms') {
                    $('.password-field').hide();
                    $('.sms-field').show();
                    $('.el-button-login').show();
                    $('.sms-wx-field').hide();
                    $('input[name=auth_type]').val('auth_sms');
                    $('#user_name').parent().removeClass('user-input');
                    $('#user_name').parent().addClass('phone-input');
                    $('#user_name').attr('placeholder', "手机号");
                    $('.phone-input').show();
                    $('.remember-field').hide();
                    $('.wechat-qrcode').hide();
                } else if ($(this).data('type') == 'auth_web_wechat') {
                    
                } else {
                    $('.sms-field').show();
                    $('.sms-wx-field').show();
                    $('.password-field').hide();
                    $('input[name=auth_type]').val('auth_wx_sms');
                    $('#user_name').parent().removeClass('user-input');
                    $('#user_name').parent().addClass('phone-input');
                    $('#user_name').attr('placeholder', "手机号");
                    $('.phone-input').show();
                    $('.el-button-login').show();
                    $('.remember-field').hide();
                    $('.wechat-qrcode').hide();
                }
            });

            $('#help_mark').hover(function () {
                var display_width = getWidth() / 2 + 50;
                var display_height = getHeight() / 2;
                if (display_width <= 416) {
                    var offset = 'auto';
                } else {
                    var offset = [display_height + 'px', display_width + 'px'];
                }
                layer.open({
                    type: 1,
                    shade: 0,
                    title: false,
                    shadeClose: true,
                    closeBtn: 0,
                    offset: offset,
                    area: ['320px'],
                    content: $('#wechat_tip')
                });

            }, function () {
                layer.closeAll();
            });

        });

        
        function getWidth() {
            if (window.innerWidth) {
                winWidth = window.innerWidth;
            } else if ((document.body) && (document.body.clientWidth)) {
                winWidth = document.body.clientWidth;
            }
            if (document.documentElement && document.documentElement.clientHeight && document.documentElement.clientWidth) {
                winWidth = document.documentElement.clientWidth;
            }
            return winWidth;
        }

        
        function getHeight() {
            if (window.innerHeight) {
                winHeight = window.innerHeight;
            } else if ((document.body) && (document.body.clientHeight)) {
                winHeight = document.body.clientHeight;
            }
            if (document.documentElement && document.documentElement.clientHeight && document.documentElement.clientWidth) {
                winHeight = document.documentElement.clientHeight;
            }
            return winHeight;
        }

        function browserCheck() {
            

            var avail_browsers = ['IE11', 'Edge', 'Chrome', 'Firefox', 'Safari', 'Mobile']
            
            var isOpera = (!!window.opr && !!opr.addons) || !!window.opera || navigator.userAgent.indexOf(' OPR/') >= 0;

            
            var isFirefox = typeof InstallTrigger !== 'undefined';

            
            var isSafari = /constructor/i.test(window.HTMLElement) || (function (p) {
                return p.toString() === "[object SafariRemoteNotification]";
            })(!window['safari'] || (typeof safari !== 'undefined' && safari.pushNotification));

            
            var isIE =  false || !!document.documentMode;

            
            var isEdge = !isIE && !!window.StyleMedia;

            
            var isChrome = !!window.chrome && (!!window.chrome.webstore || !!window.chrome.runtime || !!window.chrome.loadTimes);

            isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
            for (var i in avail_browsers) {
                switch (avail_browsers[i]) {
                    case 'IE11':
                        if (isIE && parseInt(document.documentMode) >= 8) {
                            return true;
                        }
                        break;
                    case 'Edge':
                        if (isEdge) {
                            return true;
                        }
                        break;
                    case 'Chrome':
                        if (isChrome) {
                            return true;
                        }
                        break;
                    case 'Firefox':
                        if (isFirefox) {
                            return true;
                        }
                        break;
                    case 'Mobile':
                        if (isMobile) {
                            return true;
                        }
                        break;
                    case 'Safari':
                        if (isSafari) {
                            return true;
                        }
                }

            }
            return false;
        }

        var isMobile = false;

        var check = browserCheck()
        if (!check) {
            alert("您的浏览器无法正常打开WEBVPN界面，请更新您的浏览器")
        }

    </script>
    

</body>
</html>
